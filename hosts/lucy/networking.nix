{config, ...}: {
  sops.secrets."wg0.key" = {
    sopsFile = ../../secrets/wireguard/lucy/private.key;
    format = "binary";
  };

  networking = {
    hostName = "lucy";

    wireguard = {
      enable = true;
      interfaces = {
        "wg0" = {
          privateKeyFile = config.sops.secrets."wg0.key".path;
          listenPort = 51820;
          ips = [
            "10.0.2.2/32"
          ];
          peers = [
          {
            name = "ino";
            publicKey = "qHMx1AVRw9eqY3udX41cEnLnV8CV6VoG1Ic9hivRIXQ=";
            endpoint = "45.81.233.66:51820";
            allowedIPs = [
              "0.0.0.0/3" "32.0.0.0/5" "40.0.0.0/6" "44.0.0.0/8" "45.0.0.0/10" "45.64.0.0/12" "45.80.0.0/16" "45.81.0.0/17" "45.81.128.0/18" "45.81.192.0/19" "45.81.224.0/21" "45.81.232.0/24" "45.81.233.0/26" "45.81.233.64/31" "45.81.233.67/32" "45.81.233.68/30" "45.81.233.72/29" "45.81.233.80/28" "45.81.233.96/27" "45.81.233.128/25" "45.81.234.0/23" "45.81.236.0/22" "45.81.240.0/20" "45.82.0.0/15" "45.84.0.0/14" "45.88.0.0/13" "45.96.0.0/11" "45.128.0.0/9" "46.0.0.0/7" "48.0.0.0/4" "64.0.0.0/2" "128.0.0.0/2" "192.0.0.0/9" "192.128.0.0/11" "192.160.0.0/13" "192.168.0.0/17" "192.168.128.0/19" "192.168.160.0/20" "192.168.176.0/23" "192.168.179.0/24" "192.168.180.0/22" "192.168.184.0/21" "192.168.192.0/18" "192.169.0.0/16" "192.170.0.0/15" "192.172.0.0/14" "192.176.0.0/12" "192.192.0.0/10" "193.0.0.0/8" "194.0.0.0/7" "196.0.0.0/6" "200.0.0.0/5" "208.0.0.0/4" "224.0.0.0/3"
            ];
          }
          ];
        };
      };
    };

    firewall = {
      allowedUDPPorts = [ config.networking.wireguard.interfaces."wg0".listenPort ];
    };
  };
}
